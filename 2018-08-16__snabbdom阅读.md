## snabbdom 源码阅读

随着React Vue等框架的流行，Virtual DOM也越来越火，snabbdom是其中一种实现，而且Vue 2.x版本的Virtual DOM部分也是基于snabbdom进行修改的。snabbdom这个库核心代码只有200多行，非常适合想要深入了解Virtual DOM实现的读者阅读。如果您没听说过snabbdom，请先移步[官方文档](https://github.com/snabbdom/snabbdom)/。另外在此之前，需要先了解什么是Virtual DOM。

### 什么是Virtual DOM

通俗的说，Virtual DOM就是一个js对象，它是真实DOM的抽象，只保留一个有用的信息，更轻量地描述DOM树的结构。

### 源码分析

首先从一个简单的例子入手，一步一步分析整个代码的执行过程，下面是官方的一个简单示例：

```js
var snabbdom = require('snabbdom');
var patch = snabbdom.init([ // Init patch function with chosen modules
  require('snabbdom/modules/class').default, // makes it easy to toggle classes
  require('snabbdom/modules/props').default, // for setting properties on DOM elements
  require('snabbdom/modules/style').default, // handles styling on elements with support for animations
  require('snabbdom/modules/eventlisteners').default, // attaches event listeners
]);
var h = require('snabbdom/h').default; // helper function for creating vnodes

var container = document.getElementById('container');

var vnode = h('div#container.two.classes', {on: {click: someFn}}, [
  h('span', {style: {fontWeight: 'bold'}}, 'This is bold'),
  ' and this is just normal text',
  h('a', {props: {href: '/foo'}}, 'I\'ll take you places!')
]);
// Patch into empty DOM element – this modifies the DOM as a side effect
patch(container, vnode);

var newVnode = h('div#container.two.classes', {on: {click: anotherEventHandler}}, [
  h('span', {style: {fontWeight: 'normal', fontStyle: 'italic'}}, 'This is now italic type'),
  ' and this is still just normal text',
  h('a', {props: {href: '/bar'}}, 'I\'ll take you places!')
]);
// Second `patch` invocation
patch(vnode, newVnode); // Snabbdom efficiently updates the old view to the new state
```

首先`snabbdom`模块提供一个`init`方法，它接收一个数组，数组中是各种`module`，这样的设计使得这个库更具扩展性，我们也可以实现自己的`module`，而且可以根据自己的需要引入相应的`module`，比如如果不需要写入`class`，那你可以直接把`class`的模块移除。
调用`init`方法会返回一个`patch`函数，这个函数接受两个参数，第一个是旧的`vnode`节点或是`dom`节点，第二个参数是新的`vnode`节点，调用`patch`函数会对dom进行更新。`vnode`可以通过使用`h`函数来生成。使用起来相当简单，这也是本文接下来要分析的内容。

#### init 方法

